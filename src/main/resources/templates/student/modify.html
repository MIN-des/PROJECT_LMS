<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
  <title>Kaiadmin - Admin Dashboard</title>
  <meta content="width=device-width, initial-scale=1.0, shrink-to-fit=no" name="viewport"/>
  <link rel="icon" href="/assets/img/kaiadmin/favicon.ico" type="image/x-icon"/>

  <!-- Fonts and icons -->
  <script src="/assets/js/plugin/webfont/webfont.min.js"></script>
  <script>
    WebFont.load({
      google: { families: ["Public Sans:300,400,500,600,700"] },
      custom: {
        families: [
          "Font Awesome 5 Solid",
          "Font Awesome 5 Regular",
          "Font Awesome 5 Brands",
          "simple-line-icons",
        ],
        urls: ["/assets/css/fonts.min.css"],
      },
      active: function () {
        sessionStorage.fonts = true;
      },
    });
  </script>

  <!-- CSS Files -->
  <link rel="stylesheet" href="/assets/css/bootstrap.min.css"/>
  <link rel="stylesheet" href="/assets/css/plugins.min.css"/>
  <link rel="stylesheet" href="/assets/css/kaiadmin.min.css"/>
</head>
<body>
<div class="wrapper">
  <!-- Sidebar -->
  <div class="sidebar" data-background-color="dark">
    <div class="sidebar-logo">
      <div class="logo-header" data-background-color="dark">
        <a href="index.html" class="logo">
          <img src="/assets/img/kaiadmin/logo_light.svg" alt="navbar brand" class="navbar-brand" height="20"/>
        </a>
        <div class="nav-toggle">
          <button class="btn btn-toggle toggle-sidebar">
            <i class="gg-menu-right"></i>
          </button>
        </div>
      </div>
    </div>
    <div class="sidebar-wrapper scrollbar scrollbar-inner">
      <div class="sidebar-content">
        <ul class="nav nav-secondary">
          <li class="nav-item active">
            <a data-bs-toggle="collapse" href="#dashboard" class="collapsed" aria-expanded="false">
              <i class="fas fa-home"></i>
              <p>Dashboard</p>
              <span class="caret"></span>
            </a>
            <div class="collapse" id="dashboard">
              <ul class="nav nav-collapse">
                <li>
                  <a href="../demo1/index.html">
                    <span class="sub-item">Dashboard 1</span>
                  </a>
                </li>
              </ul>
            </div>
          </li>
          <li class="nav-section">
            <span class="sidebar-mini-icon">
              <i class="fa fa-ellipsis-h"></i>
            </span>
            <h4 class="text-section">Components</h4>
          </li>
          <li class="nav-item">
            <a data-bs-toggle="collapse" href="#base">
              <i class="fas fa-layer-group"></i>
              <p>Base</p>
              <span class="caret"></span>
            </a>
            <div class="collapse" id="base">
              <ul class="nav nav-collapse">
                <li>
                  <a href="/components/avatars.html">
                    <span class="sub-item">Avatars</span>
                  </a>
                </li>
                <li>
                  <a href="/components/buttons.html">
                    <span class="sub-item">Buttons</span>
                  </a>
                </li>
                <li>
                  <a href="/components/gridsystem.html">
                    <span class="sub-item">Grid System</span>
                  </a>
                </li>
                <li>
                  <a href="/components/panels.html">
                    <span class="sub-item">Panels</span>
                  </a>
                </li>
                <li>
                  <a href="/components/notifications.html">
                    <span class="sub-item">Notifications</span>
                  </a>
                </li>
              </ul>
            </div>
          </li>
        </ul>
      </div>
    </div>
  </div>
  <!-- End Sidebar -->

  <div class="main-panel">
    <div class="main-header">
      <div class="main-header-logo">
        <div class="logo-header" data-background-color="dark">
          <a href="index.html" class="logo">
            <img src="/assets/img/kaiadmin/logo_light.svg" alt="navbar brand" class="navbar-brand" height="20"/>
          </a>
        </div>
      </div>
      <nav class="navbar navbar-header navbar-header-transparent navbar-expand-lg border-bottom">
        <div class="container-fluid">
          <ul class="navbar-nav topbar-nav ms-md-auto align-items-center">
            <li class="nav-item topbar-user dropdown hidden-caret">
              <a class="dropdown-toggle profile-pic" data-bs-toggle="dropdown" href="#" aria-expanded="false">
                <div class="avatar-sm">
                  <img src="/assets/img/profile.jpg" alt="..." class="avatar-img rounded-circle"/>
                </div>
                <span class="profile-username">
                  <span class="op-7">Hi,</span>
                  <span class="fw-bold">Hizrian</span>
                </span>
              </a>
              <ul class="dropdown-menu dropdown-user animated fadeIn">
                <div class="dropdown-user-scroll scrollbar-outer">
                  <li>
                    <a class="dropdown-item" href="#">Logout</a>
                  </li>
                </div>
              </ul>
            </li>
          </ul>
        </div>
      </nav>
    </div>

    <div class="container mt-8">
      <div class="row justify-content-center">
        <div class="col-lg-8">
          <div class="card shadow">
            <div class="card-header bg-primary text-white text-center">
              <h5>학생 정보 수정</h5>
            </div>
            <div class="card-body">
              <form th:action="@{/student/modify/{sId}(sId=${student.sId})}" th:object="${student}" method="post">
                <div th:if="${errorMessage}" class="alert alert-danger" role="alert">
                  <span th:text="${errorMessage}"></span>
                </div>
                <div class="mb-3">
                  <label for="sId" class="form-label">학번</label>
                  <input type="text" class="form-control" id="sId" th:field="*{sId}" readonly>
                </div>
                <div class="mb-3">
                  <label for="sName" class="form-label">이름</label>
                  <input type="text" class="form-control" id="sName" th:field="*{sName}" readonly>
                </div>
                <div class="mb-3">
                  <label for="pPw" class="form-label">비밀번호</label>
                  <div class="input-group">
                    <input type="password" id="pPw" value="******" class="form-control" readonly/>
                    <button type="button" class="btn btn-outline-primary" onclick="toggleEdit('newPw')">수정
                    </button>
                  </div>
                  <input type="password" id="newPw" name="newPw" class="form-control mt-2"
                         placeholder="새 비밀번호 입력"
                         style="display: none;">
                </div>
                <div class="mb-3">
                  <label for="sTel" class="form-label">전화번호</label>
                  <div class="input-group">
                    <input type="text" id="sTel" th:value="${student.sTel}" class="form-control"
                           readonly/>
                    <button type="button" class="btn btn-outline-primary" onclick="toggleEdit('newSTel')">수정
                    </button>
                  </div>
                  <input type="text" id="newSTel" name="newSTel" class="form-control mt-2"
                         placeholder="새 전화번호 입력"
                         style="display: none;">
                </div>
                <div class="mb-3">
                  <label for="sAdd" class="form-label">주소</label>
                  <div class="input-group">
                    <input type="text" id="sAdd" th:value="${student.sAdd}" class="form-control"
                           readonly/>
                    <button type="button" class="btn btn-outline-primary" onclick="toggleAddressEdit()">수정
                    </button>
                  </div>
                  <div id="newAddressContainer" style="display: none;" class="mt-2">
                    <div class="input-group">
                      <input type="text" id="newSAdd" name="newSAdd" class="form-control"
                             placeholder="새 주소 입력"/>
                      <button type="button" class="btn btn-outline-primary" data-bs-toggle="modal"
                              data-bs-target="#addressModal">주소 검색
                      </button>
                    </div>
                  </div>
                </div>
                <div class="mb-3">
                  <label for="sBirth" class="form-label">생년월일</label>
                  <input type="date" class="form-control" id="sBirth" th:field="*{sBirth}" readonly>
                </div>
                <div class="mb-3">
                  <label for="sEmail" class="form-label">이메일</label>
                  <input type="email" class="form-control" id="sEmail" th:field="*{sEmail}" readonly>
                </div>
                <div class="mb-3">
                  <label for="grade" class="form-label">학년</label>
                  <input type="number" class="form-control" id="grade" th:field="*{grade}" readonly>
                </div>
                <div class="mb-3">
                  <label for="sDept" class="form-label">단과</label>
                  <input type="text" class="form-control" id="sDept" th:value="${student.sDept.koreanName}" readonly>
                </div>
                <div class="mb-3">
                  <label for="sGen" class="form-label">성별</label>
                  <input type="text" class="form-control" id="sGen" th:value="${student.sGen.koreanName}" readonly>
                </div>
                <div class="d-flex justify-content-between">
                  <button type="submit" class="btn btn-outline-primary">저장</button>
                  <a th:href="@{/student/info}" class="btn btn-outline-danger">취소</a>
                </div>
              </form>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="modal fade" id="addressModal" tabindex="-1" aria-labelledby="addressModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-lg">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="addressModalLabel">주소 검색</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <div class="input-group mb-3">
              <input type="text" id="addressSearchInput" class="form-control"
                     placeholder="도로명 또는 지번 주소를 입력하세요">
              <button type="button" class="btn btn-primary" onclick="searchAddress()">검색</button>
            </div>
            <div id="addressResult" class="list-group"></div>
          </div>
        </div>
      </div>
    </div>

    <footer class="footer">
      <div class="container-fluid d-flex justify-content-between">
        <nav class="pull-left">
          <div class="copyright">
            2024, made with by goott
          </div>
        </nav>
      </div>
    </footer>
  </div>
</div>

<!-- Core JS Files -->
<script src="/assets/js/core/jquery-3.7.1.min.js"></script>
<script src="/assets/js/core/popper.min.js"></script>
<script src="/assets/js/core/bootstrap.min.js"></script>

<!-- Plugins -->
<script src="/assets/js/plugin/jquery-scrollbar/jquery.scrollbar.min.js"></script>
<script src="/assets/js/plugin/sweetalert/sweetalert.min.js"></script>
<script src="/assets/js/kaiadmin.min.js"></script>
<script>
  function toggleEdit(fieldId) {
      const inputField = document.getElementById(fieldId);
      if (inputField) {
          inputField.style.display = "block";
          inputField.focus();
      }
  }

  function toggleAddressEdit() {
      const newAddressContainer = document.getElementById("newAddressContainer");
      if (newAddressContainer.style.display === "none") {
          newAddressContainer.style.display = "block";
      } else {
          newAddressContainer.style.display = "none";
      }
  }

</script>

</body>
<script>
  function searchAddress() {
     const query = document.getElementById('addressSearchInput').value;
     if (!query) {
         alert('주소를 입력하세요!');
         return;
     }

     // Kakao 주소 검색 API 요청
     const apiUrl = `https://dapi.kakao.com/v2/local/search/address.json?query=${encodeURIComponent(query)}`;
     const apiKey = ''; // 자신의 Kakao API 키로 변경

     fetch(apiUrl, {
         method: 'GET',
         headers: { 'Authorization': `KakaoAK ${apiKey}` }
     })
         .then(response => response.json())
         .then(data => {
             const results = data.documents;
             const resultContainer = document.getElementById('addressResult');
             resultContainer.innerHTML = '';

             if (results.length === 0) {
                 resultContainer.innerHTML = '<div class="text-danger">검색 결과가 없습니다.</div>';
                 return;
             }

             results.forEach(result => {
                 const address = result.address_name;
                 const item = document.createElement('button');
                 item.classList.add('list-group-item', 'list-group-item-action');
                 item.textContent = address;

                 // 검색된 주소를 'newPAdd' 필드에 입력
                 item.onclick = () => {
                     document.getElementById('newSAdd').value = address;
                     const modal = bootstrap.Modal.getInstance(document.getElementById('addressModal'));
                     modal.hide(); // 모달 닫기
                 };
                 resultContainer.appendChild(item);
             });
         })
         .catch(error => {
             console.error('Error:', error);
             alert('주소 검색 중 오류가 발생했습니다.');
         });
 }
</script>
</html>
